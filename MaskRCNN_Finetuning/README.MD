# Mask Generation Pipeline

This repository provides a pipeline for generating and fine-tuning masks for object detection using **Mask R-CNN** with two different backbones: **ResNet50** and **ResNet101**. The pipeline includes scripts for data preparation, model training, mask generation, and visualization of training results.

## Overview

The pipeline consists of four main components:
1. **Data Preparation**: Preparing the dataset required for Mask R-CNN training.
2. **Mask R-CNN Fine-tuning**: Fine-tuning Mask R-CNN on the prepared dataset using ResNet50 and ResNet101 backbones.
3. **Ground Truth Mask Generation**: Ensuring accurate ground truth visible masks are generated for training.
4. **Training Visualization**: Plotting the training results using TensorBoard.

## Steps

### Step 1: Data Preparation

Before fine-tuning Mask R-CNN, the training data needs to be prepared. The **prepare_data.ipynb** notebook is provided to convert the raw data from the **Data_Generation_Preparation** scripts into a format suitable for Mask R-CNN training.

- **Input**: Data generated from the `Data_Generation_Preparation` scripts.
- **Output**: A dataset with images and corresponding annotations, including masks for visible objects.

#### Instructions:
1. Run the **prepare_data.ipynb** notebook to preprocess the data.
   
   ```bash
   jupyter notebook prepare_data.ipynb
   ```

2. The notebook will organize and format the data for Mask R-CNN training by extracting relevant image information and ground truth visible masks.
   
   - Make sure the ground truth visible masks are properly generated from the **Data_Generation_Preparation** scripts, as these are essential for accurate fine-tuning.

### Step 2: Fine-tuning Mask R-CNN

Once the dataset is ready, the Mask R-CNN model can be fine-tuned on the training data. Two notebooks are provided in the **notebook** folder for this purpose:

1. **ResNet50 Backbone**: `mask.ipynb`
2. **ResNet101 Backbone**: `mask-101.ipynb`

These notebooks allow you to train Mask R-CNN on either the ResNet50 or ResNet101 backbone, providing flexibility depending on your performance and computational requirements.

#### Instructions:
1. Choose the appropriate backbone (ResNet50 or ResNet101) and open the corresponding notebook.
   
   ```bash
   jupyter notebook mask.ipynb  # For ResNet50
   jupyter notebook mask-101.ipynb  # For ResNet101
   ```

2. Load the prepared dataset from the previous step.
3. Follow the steps in the notebook to fine-tune the Mask R-CNN model on your dataset.
4. Adjust hyperparameters such as learning rate, batch size, and epochs as needed to optimize the training process.
5. After training is complete, the fine-tuned model will generate masks for object detection, which can be used for downstream tasks such as pose estimation.

### Step 3: Ground Truth Visible Mask Generation

For accurate fine-tuning, it is critical to have precise ground truth visible masks. These masks can be generated using the scripts from the **Data_Generation_Preparation** folder.

- **Note**: If the masks are not accurate, the model will not be able to learn effectively during fine-tuning. Make sure to verify the mask quality before starting the training process.

### Step 4: Training Visualization

Once the model is trained, you can visualize the training process, including loss, accuracy, and other metrics, using TensorBoard. The **plot_tensorboard.py** script is provided to help you easily visualize these results.

#### Instructions:
1. After fine-tuning the model, use TensorBoard to visualize the training logs.
2. Run the `plot_tensorboard.py` script to automatically generate plots of the training results.

   ```bash
   python plot_tensorboard.py --log_dir=<path_to_tensorboard_logs>
   ```

3. The script will generate plots of key metrics (such as training/validation loss and accuracy) over time to help analyze the model's performance.

## Summary of Files and Notebooks

- **prepare_data.ipynb**: Notebook for preparing the dataset from raw data generated by **Data_Generation_Preparation** scripts.
- **mask.ipynb**: Fine-tunes Mask R-CNN using the ResNet50 backbone.
- **mask-101.ipynb**: Fine-tunes Mask R-CNN using the ResNet101 backbone.
- **plot_tensorboard.py**: Script to visualize training results using TensorBoard logs.

---

### Additional Notes

- Install all necessary dependencies before running the notebooks. A comprehensive and environment-specific configuration file, `environment.yml`, is provided for easy setup.
  
  You can install the complete environment using the following command:

  ```bash
  conda env create -f environment.yml
  ```
   or

  You can install the dependencies by running:

  ```bash
  pip install -r requirements.txt
  ```
- Ensure that you have a GPU-enabled environment for faster training of Mask R-CNN models.
- Ground truth visible masks are crucial for effective training, so double-check their accuracy before starting fine-tuning.
- TensorBoard provides a useful tool to track and visualize the progress of model training, making it easier to spot any issues or improvements in performance.

---
